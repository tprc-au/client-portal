<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TPRC Client Portal - Applicant Profile</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="css/tprc-brand.css" rel="stylesheet">
    <link href="css/styles.css" rel="stylesheet">
</head>
<body class="applicant-page">
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-tprc-primary">
        <div class="container-fluid">
            <a class="navbar-brand" href="dashboard.html">
                <svg width="153" height="50" viewBox="0 0 153 50" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M27.4569 33.4243C25.1365 38.3108 20.1736 41.6685 14.4464 41.6685C6.46975 41.6685 0 35.1332 0 27.0692C0 19.0052 6.46975 12.47 14.4464 12.47C20.6541 12.47 25.8299 16.4173 27.9319 21.9972C23.9135 23.8262 21.6368 21.4785 21.6368 21.4785C19.9771 19.2782 17.3673 17.8587 14.43 17.8587C9.41799 17.8587 5.36143 21.9808 5.36143 27.0638C5.36143 32.1467 9.42345 36.2688 14.43 36.2688C17.1216 36.2688 19.5403 35.0786 21.2055 33.1896C21.2055 33.1896 24.0445 33.943 27.4623 33.4298L27.4569 33.4243Z" fill="#939D9E"></path>
                <path d="M12.0987 9.91479C14.419 5.02835 19.3819 1.67064 25.1091 1.67064C33.0858 1.67064 39.5555 8.2059 39.5555 16.2699C39.5555 24.3339 33.0858 30.8691 25.1091 30.8691C18.9014 30.8691 13.7256 26.9218 11.6237 21.342C15.642 19.513 17.9187 21.8606 17.9187 21.8606C19.5784 24.0609 22.1882 25.4804 25.1255 25.4804C30.1375 25.4804 34.1941 21.3583 34.1941 16.2753C34.1941 11.1924 30.1321 7.07028 25.1255 7.07028C22.4339 7.07028 20.0152 8.2605 18.35 10.1496C18.35 10.1496 15.511 9.39612 12.0932 9.90933L12.0987 9.91479Z" fill="#FF4C00"></path>
                <path fill-rule="evenodd" clip-rule="evenodd" d="M50.6497 13.8185V30.0666H50.6442C50.6442 36.5909 54.4442 39.1406 60.2533 39.1406C61.8584 39.1406 63.338 38.9605 64.6429 38.6056V32.9111C63.5182 33.0312 62.9831 33.0312 62.2734 33.0312C59.0685 33.0312 58.2386 31.5516 58.2386 28.8818V13.8185H64.288V7.88927H58.2386V0H50.6497V7.88927H45.4902V13.8185H50.6497ZM76.7962 7.8893H69.2072V50H76.7962V34.287C78.2812 37.1915 81.841 39.3263 86.3452 39.3263C92.9842 39.3263 99.9235 34.5818 99.9235 23.313C99.9235 12.0441 92.9897 7.29965 86.3452 7.29965C81.8355 7.29965 78.2812 9.43439 76.7962 12.339V7.8893ZM92.8095 23.3075C92.8095 29.9465 88.8348 32.9712 84.5653 32.9712C80.416 32.9712 76.4413 29.9465 76.4413 23.3075C76.4413 16.6685 80.2959 13.6438 84.5653 13.6438C88.8348 13.6438 92.8095 16.6685 92.8095 23.3075ZM103.669 7.88924H111.252V15.2435H111.433C112.443 11.0941 115.347 7.53436 120.567 7.53436C121.276 7.53436 122.106 7.59441 122.936 7.82918V14.2334C122.046 14.1133 121.336 14.0532 120.567 14.0532C115.467 14.0532 111.258 17.138 111.258 24.3721V38.7202H103.669V7.88924ZM139.004 7.29414C131.295 7.29414 123.646 11.9786 123.646 23.3621C123.646 34.751 131.295 39.3153 139.004 39.3153C144.464 39.3153 151.873 37.0059 152.823 27.1019H145.943C145.168 31.1913 142.558 32.9111 138.944 32.9111C133.664 32.9111 130.76 29.1712 130.76 23.3621C130.76 17.5529 133.664 13.6984 138.944 13.6984C142.444 13.6984 145.174 15.3035 145.943 19.4529H152.823C151.692 9.48894 144.398 7.29414 139.004 7.29414Z" fill="#FF4C00"></path>
                </svg>
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="dashboard.html">
                            <i class="fas fa-tachometer-alt me-1"></i>Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="company-profile.html">
                            <i class="fas fa-building me-1"></i>Company Profile
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="documents.html">
                            <i class="fas fa-file-upload me-1"></i>Documents
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="support.html">
                            <i class="fas fa-life-ring me-1"></i>Support
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="post-selection.html">
                            <i class="fas fa-route me-1"></i>Pipeline
                        </a>
                    </li>
                </ul>
                
                <ul class="navbar-nav">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-user-circle me-2"></i>
                            <span id="user-name">Loading...</span>
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="company-profile.html" id="company-profile">
                                <i class="fas fa-building me-2"></i>Company Profile
                            </a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#" id="logout-btn">
                                <i class="fas fa-sign-out-alt me-2"></i>Logout
                            </a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Breadcrumb -->
    <div class="container-fluid mt-3">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="dashboard.html">Dashboard</a></li>
                <li class="breadcrumb-item"><a href="#" id="job-order-link">Job Order</a></li>
                <li class="breadcrumb-item active">Applicant Profile</li>
            </ol>
        </nav>
    </div>

    <!-- Main Content -->
    <div class="container-fluid">
        <!-- Applicant Header -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <div class="row align-items-center">
                            <div class="col-md-2 text-center">
                                <div class="applicant-avatar mb-3">
                                    <i class="fas fa-user-circle fa-5x text-muted" id="applicant-avatar"></i>
                                </div>
                                <span class="badge bg-secondary" id="applicant-status">Status</span>
                            </div>
                            <div class="col-md-7">
                                <h2 class="mb-2" id="applicant-name">Loading...</h2>
                                <div class="d-flex flex-wrap gap-3 mb-3">
                                    <span><i class="fas fa-birthday-cake text-muted me-1"></i><span id="applicant-age">-</span> years old</span>
                                    <span><i class="fas fa-map-marker-alt text-muted me-1"></i><span id="applicant-location">-</span></span>
                                    <span><i class="fas fa-envelope text-muted me-1"></i><span id="applicant-email">-</span></span>
                                    <span><i class="fas fa-phone text-muted me-1"></i><span id="applicant-phone">-</span></span>
                                </div>
                                <p class="mb-0 text-muted" id="applicant-summary">Loading applicant summary...</p>
                            </div>
                            <div class="col-md-3 text-end">
                                <div class="btn-group-vertical w-100 gap-2">
                                    <button class="btn btn-success btn-sm" onclick="showActionModal('approve')" id="approve-btn">
                                        <i class="fas fa-check me-1"></i>Approve
                                    </button>
                                    <button class="btn btn-info btn-sm" onclick="showActionModal('reserve')" id="reserve-btn">
                                        <i class="fas fa-bookmark me-1"></i>Reserve/Interview
                                    </button>
                                    <button class="btn btn-warning btn-sm" onclick="showClientScorecard()" id="scorecard-btn" style="display:none;">
                                        <i class="fas fa-clipboard-list me-1"></i>Assessment
                                    </button>
                                    <button class="btn btn-danger btn-sm" onclick="showActionModal('reject')" id="reject-btn">
                                        <i class="fas fa-times me-1"></i>Reject
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Applicant Details Tabs -->
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <ul class="nav nav-tabs card-header-tabs" id="applicantTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="overview-tab" data-bs-toggle="tab" data-bs-target="#overview" type="button" role="tab">
                                    <i class="fas fa-user me-1"></i>Overview
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="documents-tab" data-bs-toggle="tab" data-bs-target="#documents" type="button" role="tab">
                                    <i class="fas fa-file-alt me-1"></i>Documents
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="assessments-tab" data-bs-toggle="tab" data-bs-target="#assessments" type="button" role="tab">
                                    <i class="fas fa-chart-bar me-1"></i>Test Results
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="media-tab" data-bs-toggle="tab" data-bs-target="#media" type="button" role="tab">
                                    <i class="fas fa-photo-video me-1"></i>Media
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="scorecard-tab" data-bs-toggle="tab" data-bs-target="#scorecard" type="button" role="tab">
                                    <i class="fas fa-clipboard-check me-1"></i>Scorecard
                                </button>
                            </li>
                        </ul>
                    </div>
                    <div class="card-body">
                        <div class="tab-content" id="applicantTabsContent">
                            <!-- Overview Tab -->
                            <div class="tab-pane fade show active" id="overview" role="tabpanel">
                                <div class="row">
                                    <div class="col-md-6">
                                        <h6>Professional Summary</h6>
                                        <p id="professional-summary">Loading...</p>
                                        
                                        <h6>Key Skills</h6>
                                        <div id="key-skills" class="mb-3">
                                            <span class="badge bg-light text-dark me-1 mb-1">Loading...</span>
                                        </div>
                                        
                                        <h6>Languages</h6>
                                        <div id="languages" class="mb-3">
                                            <span class="badge bg-info me-1 mb-1">Loading...</span>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <h6>Work Experience</h6>
                                        <div id="work-experience" class="timeline-small">
                                            <div class="text-muted">Loading work experience...</div>
                                        </div>
                                        
                                        <h6>Education</h6>
                                        <div id="education" class="timeline-small">
                                            <div class="text-muted">Loading education...</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Documents Tab -->
                            <div class="tab-pane fade" id="documents" role="tabpanel">
                                <div class="row">
                                    <div class="col-12">
                                        <h6>Available Documents</h6>
                                        <div id="document-list" class="list-group">
                                            <div class="text-center py-4">
                                                <div class="spinner-border text-primary" role="status">
                                                    <span class="visually-hidden">Loading...</span>
                                                </div>
                                                <p class="mt-2 mb-0">Loading documents...</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Assessments Tab -->
                            <div class="tab-pane fade" id="assessments" role="tabpanel">
                                <div class="row">
                                    <div class="col-md-6">
                                        <h6>Technical Skills Assessment</h6>
                                        <div id="technical-scores">
                                            <div class="text-muted">Loading test results...</div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <h6>Personality Assessment</h6>
                                        <div id="personality-scores">
                                            <div class="text-muted">Loading personality results...</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <hr>
                                
                                <div class="row">
                                    <div class="col-12">
                                        <h6>Assessment Links</h6>
                                        <div id="assessment-links">
                                            <div class="text-muted">Loading assessment links...</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Media Tab -->
                            <div class="tab-pane fade" id="media" role="tabpanel">
                                <div class="row">
                                    <div class="col-12">
                                        <h6>Documentary Evidence</h6>
                                        <div id="media-gallery" class="row">
                                            <div class="col-12 text-center py-4">
                                                <div class="spinner-border text-primary" role="status">
                                                    <span class="visually-hidden">Loading...</span>
                                                </div>
                                                <p class="mt-2 mb-0">Loading media files...</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Scorecard Tab -->
                            <div class="tab-pane fade" id="scorecard" role="tabpanel">
                                <div class="row">
                                    <div class="col-12">
                                        <div id="scorecard-content">
                                            <div class="text-center py-4">
                                                <div class="spinner-border text-primary" role="status">
                                                    <span class="visually-hidden">Loading...</span>
                                                </div>
                                                <p class="mt-2 mb-0">Loading scorecard...</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Action Modal -->
    <div class="modal fade" id="actionModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="actionModalTitle">Applicant Action</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="action-form">
                        <input type="hidden" id="action-type" name="actionType">
                        
                        <div class="mb-3">
                            <label for="action-reason" class="form-label">Reason *</label>
                            <select class="form-select" id="action-reason" name="reason" required>
                                <!-- Options populated by JavaScript -->
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label for="action-notes" class="form-label">Additional Notes</label>
                            <textarea class="form-control" id="action-notes" name="notes" rows="4" placeholder="Add any additional comments..."></textarea>
                        </div>
                        
                        <div class="mb-3" id="interview-scheduling" style="display: none;">
                            <label for="interview-date" class="form-label">Interview Date & Time</label>
                            <input type="datetime-local" class="form-control" id="interview-date" name="interviewDate">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="confirm-action-btn">Confirm Action</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Client Assessment Scorecard Modal -->
    <div class="modal fade" id="scorecardModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Client Assessment Scorecard</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="scorecard-form">
                        <div class="row">
                            <div class="col-md-6">
                                <h6>Technical Competency</h6>
                                <div class="mb-3">
                                    <label class="form-label">Technical Skills (1-5)</label>
                                    <select class="form-select" name="technical_skills" required>
                                        <option value="">Select Rating</option>
                                        <option value="5">5 - Exceptional</option>
                                        <option value="4">4 - Above Average</option>
                                        <option value="3">3 - Satisfactory</option>
                                        <option value="2">2 - Below Average</option>
                                        <option value="1">1 - Inadequate</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Relevant Experience (1-5)</label>
                                    <select class="form-select" name="experience" required>
                                        <option value="">Select Rating</option>
                                        <option value="5">5 - Extensive Experience</option>
                                        <option value="4">4 - Good Experience</option>
                                        <option value="3">3 - Moderate Experience</option>
                                        <option value="2">2 - Limited Experience</option>
                                        <option value="1">1 - No Relevant Experience</option>
                                    </select>
                                </div>
                                
                                <h6>Communication & Cultural Fit</h6>
                                <div class="mb-3">
                                    <label class="form-label">English Proficiency (1-5)</label>
                                    <select class="form-select" name="english_proficiency" required>
                                        <option value="">Select Rating</option>
                                        <option value="5">5 - Native/Fluent</option>
                                        <option value="4">4 - Very Good</option>
                                        <option value="3">3 - Good</option>
                                        <option value="2">2 - Fair</option>
                                        <option value="1">1 - Poor</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Cultural Adaptability (1-5)</label>
                                    <select class="form-select" name="cultural_fit" required>
                                        <option value="">Select Rating</option>
                                        <option value="5">5 - Excellent Fit</option>
                                        <option value="4">4 - Good Fit</option>
                                        <option value="3">3 - Adequate Fit</option>
                                        <option value="2">2 - Some Concerns</option>
                                        <option value="1">1 - Poor Fit</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <h6>Professional Attributes</h6>
                                <div class="mb-3">
                                    <label class="form-label">Initiative & Problem Solving (1-5)</label>
                                    <select class="form-select" name="problem_solving" required>
                                        <option value="">Select Rating</option>
                                        <option value="5">5 - Outstanding</option>
                                        <option value="4">4 - Very Good</option>
                                        <option value="3">3 - Good</option>
                                        <option value="2">2 - Fair</option>
                                        <option value="1">1 - Poor</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Teamwork & Collaboration (1-5)</label>
                                    <select class="form-select" name="teamwork" required>
                                        <option value="">Select Rating</option>
                                        <option value="5">5 - Excellent Team Player</option>
                                        <option value="4">4 - Good Team Player</option>
                                        <option value="3">3 - Works Well in Teams</option>
                                        <option value="2">2 - Some Team Skills</option>
                                        <option value="1">1 - Poor Team Skills</option>
                                    </select>
                                </div>
                                
                                <h6>Overall Assessment</h6>
                                <div class="mb-3">
                                    <label class="form-label">Overall Rating (1-5)</label>
                                    <select class="form-select" name="overall_rating" required>
                                        <option value="">Select Overall Rating</option>
                                        <option value="5">5 - Highly Recommend</option>
                                        <option value="4">4 - Recommend</option>
                                        <option value="3">3 - Consider with Reservations</option>
                                        <option value="2">2 - Not Recommended</option>
                                        <option value="1">1 - Strongly Not Recommended</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Final Decision</label>
                                    <select class="form-select" name="final_decision" required>
                                        <option value="">Select Decision</option>
                                        <option value="approve">Approve - Move to Letter of Offer</option>
                                        <option value="reject">Reject - Return to Pool</option>
                                        <option value="hold">Hold - Need More Information</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-12">
                                <h6>Additional Comments</h6>
                                <div class="mb-3">
                                    <label class="form-label">Detailed Assessment Notes</label>
                                    <textarea class="form-control" name="assessment_notes" rows="4" placeholder="Provide detailed feedback on the candidate's suitability for the position..."></textarea>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Areas of Concern (if any)</label>
                                    <textarea class="form-control" name="concerns" rows="3" placeholder="List any areas where the candidate may need additional support or training..."></textarea>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-success" id="save-scorecard-btn">Save Assessment</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Document Viewer Modal -->
    <div class="modal fade" id="documentModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="documentModalTitle">Document Viewer</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="document-viewer" class="text-center">
                        <p>Document viewer will be implemented here</p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" id="download-document">
                        <i class="fas fa-download me-1"></i>Download
                    </button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/hubspot-api.js"></script>
    <script src="js/app.js"></script>
    <script>
        let currentApplicant = null;
        let jobOrderId = null;

        document.addEventListener('DOMContentLoaded', function() {
            // Check authentication
            if (!isAuthenticated()) {
                window.location.href = 'index.html';
                return;
            }
            
            // Get applicant ID from URL
            const urlParams = new URLSearchParams(window.location.search);
            const applicantId = urlParams.get('id');
            jobOrderId = urlParams.get('jobOrderId');
            
            if (!applicantId) {
                alert('No applicant specified');
                window.location.href = 'dashboard.html';
                return;
            }
            
            // Load applicant data
            loadApplicantDetails(applicantId);
            
            // Setup event listeners
            setupEventListeners();
        });

        function setupEventListeners() {
            // Logout
            document.getElementById('logout-btn').addEventListener('click', logout);
            
            // Action form
            document.getElementById('confirm-action-btn').addEventListener('click', submitAction);
            
            // Job order link
            if (jobOrderId) {
                document.getElementById('job-order-link').href = `job-order.html?id=${jobOrderId}`;
            }
        }

        function showActionModal(actionType) {
            const modal = document.getElementById('actionModal');
            const title = document.getElementById('actionModalTitle');
            const reasonSelect = document.getElementById('action-reason');
            const interviewDiv = document.getElementById('interview-scheduling');
            
            document.getElementById('action-type').value = actionType;
            reasonSelect.innerHTML = '';
            interviewDiv.style.display = 'none';
            
            switch(actionType) {
                case 'approve':
                    title.textContent = 'Approve Applicant';
                    reasonSelect.innerHTML = `
                        <option value="">Select reason for approval</option>
                        <option value="skills-excellent">Excellent skills match</option>
                        <option value="experience-relevant">Relevant experience</option>
                        <option value="cultural-fit">Good cultural fit</option>
                        <option value="qualifications">Strong qualifications</option>
                        <option value="interview-performance">Great interview performance</option>
                    `;
                    break;
                case 'reject':
                    title.textContent = 'Reject Applicant';
                    reasonSelect.innerHTML = `
                        <option value="">Select reason for rejection</option>
                        <option value="skills-mismatch">Skills mismatch</option>
                        <option value="experience-insufficient">Insufficient experience</option>
                        <option value="overqualified">Overqualified</option>
                        <option value="salary-expectations">Salary expectations too high</option>
                        <option value="availability">Availability issues</option>
                        <option value="communication">Communication issues</option>
                        <option value="cultural-fit">Cultural fit concerns</option>
                        <option value="other">Other</option>
                    `;
                    break;
                case 'interview':
                    title.textContent = 'Schedule Interview';
                    reasonSelect.innerHTML = `
                        <option value="">Select interview type</option>
                        <option value="phone-screening">Phone screening</option>
                        <option value="video-interview">Video interview</option>
                        <option value="in-person">In-person interview</option>
                        <option value="technical-assessment">Technical assessment</option>
                        <option value="final-interview">Final interview</option>
                    `;
                    interviewDiv.style.display = 'block';
                    break;
            }
            
            new bootstrap.Modal(modal).show();
        }

        function submitAction() {
            const form = document.getElementById('action-form');
            const formData = new FormData(form);
            
            // Validate required fields
            if (!formData.get('reason')) {
                alert('Please select a reason');
                return;
            }
            
            const actionData = {
                applicantId: currentApplicant.id,
                actionType: formData.get('actionType'),
                reason: formData.get('reason'),
                notes: formData.get('notes'),
                interviewDate: formData.get('interviewDate')
            };
            
            // Submit to HubSpot
            submitApplicantActionToHubSpot(actionData)
                .then(response => {
                    // Close modal and show success
                    bootstrap.Modal.getInstance(document.getElementById('actionModal')).hide();
                    showAlert('success', `Action "${actionData.actionType}" submitted successfully!`);
                    
                    // Update applicant status
                    loadApplicantDetails(currentApplicant.id);
                })
                .catch(error => {
                    console.error('Error submitting action:', error);
                    showAlert('danger', 'Failed to submit action. Please try again.');
                });
        }

        function showAlert(type, message) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            document.querySelector('.container-fluid').insertBefore(alertDiv, document.querySelector('.container-fluid').firstChild);
            
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.remove();
                }
            }, 5000);
        }

        function viewDocument(documentId, documentName) {
            document.getElementById('documentModalTitle').textContent = documentName;
            
            // In a real implementation, this would load the document
            document.getElementById('document-viewer').innerHTML = `
                <p class="text-muted">Document viewer for: ${documentName}</p>
                <p>In a real implementation, this would display the document content or provide a download link.</p>
            `;
            
            document.getElementById('download-document').onclick = () => {
                // Implement document download
                console.log('Downloading document:', documentId);
            };
            
            new bootstrap.Modal(document.getElementById('documentModal')).show();
        }

        // Scorecard modal functionality
        let currentCandidateId = null;

        function showScorecard(candidateId) {
            currentCandidateId = candidateId;
            
            // Load existing scorecard data if available
            loadExistingScorecard(candidateId);
            
            // Show the modal
            const modal = new bootstrap.Modal(document.getElementById('scorecardModal'));
            modal.show();
        }

        async function loadExistingScorecard(candidateId) {
            try {
                const response = await hubspotAPI.request(`/api/hubspot/candidates/${candidateId}/scorecard`);
                
                if (response && Object.keys(response).length > 0) {
                    // Pre-fill form with existing data
                    const form = document.getElementById('scorecard-form');
                    
                    Object.keys(response).forEach(key => {
                        const element = form.querySelector(`[name="${key}"]`);
                        if (element) {
                            element.value = response[key] || '';
                        }
                    });
                }
            } catch (error) {
                console.error('Error loading existing scorecard:', error);
                // Continue with empty form if no existing data
            }
        }

        async function saveScorecard() {
            try {
                const form = document.getElementById('scorecard-form');
                const formData = new FormData(form);
                
                // Validate required fields
                const requiredFields = ['technical_skills', 'experience', 'english_proficiency', 'cultural_fit', 
                                      'problem_solving', 'teamwork', 'overall_rating', 'final_decision'];
                
                const missingFields = requiredFields.filter(field => !formData.get(field));
                if (missingFields.length > 0) {
                    alert(`Please fill in all required fields: ${missingFields.join(', ')}`);
                    return;
                }
                
                // Convert FormData to object
                const scorecardData = {};
                for (let [key, value] of formData.entries()) {
                    scorecardData[key] = value;
                }
                
                // Save to backend
                const response = await hubspotAPI.request(
                    `/api/hubspot/candidates/${currentCandidateId}/scorecard`,
                    'POST',
                    scorecardData
                );
                
                // Close modal and refresh applicants
                bootstrap.Modal.getInstance(document.getElementById('scorecardModal')).hide();
                
                // Show success message
                showAlert('success', 'Assessment saved successfully');
                
                // Refresh the applicants list
                loadApplicants();
                
            } catch (error) {
                console.error('Error saving scorecard:', error);
                alert('Failed to save assessment. Please try again.');
            }
        }

        // Initialize scorecard save button on DOM load
        document.addEventListener('DOMContentLoaded', function() {
            const saveBtn = document.getElementById('save-scorecard-btn');
            if (saveBtn) {
                saveBtn.addEventListener('click', saveScorecard);
            }
        });
    </script>
</body>
</html>
